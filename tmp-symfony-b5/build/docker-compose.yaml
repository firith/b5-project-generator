version: "3"

services:
    php:
        build:
            context: ../
            dockerfile: build/configs/php/Dockerfile
        volumes:
            - ../:/app
            - symfony_framework_cache:/app/tmp-symfony/var/cache
        networks:
            - default
            - traefik

    web:
        image: nginx:latest
        labels:
            - traefik.enable=true
            - traefik.http.routers.tmp-symfony.entrypoints=http,https
            - traefik.http.routers.tmp-symfony.rule=Host(`tmp-symfony.intren.test`)
            - traefik.http.routers.tmp-symfony.tls=true
            - traefik.http.routers.tmp-symfony.service=tmp-symfony
            - traefik.http.services.tmp-symfony.loadbalancer.server.port=80
        volumes:
            - ../:/app
            - ./configs/nginx/site.conf:/etc/nginx/conf.d/default.conf
        depends_on:
            - php
        networks:
            - traefik
            - default

    node:
        image: node:lts
        volumes:
            - ../:/app
        networks:
            - default

networks:
    default:
        external: false
    traefik:
        external:
            name: traefik-gateway

volumes:
    symfony_framework_cache:
